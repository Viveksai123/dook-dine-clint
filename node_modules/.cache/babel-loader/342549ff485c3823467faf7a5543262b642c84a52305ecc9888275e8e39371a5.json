{"ast":null,"code":"import React,{useReducer}from'react';import axios from'axios';import AuthContext from'./AuthContext';import authReducer from'./authReducer';import setAuthToken from'../utils/setAuthToken';import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from'./types';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthState=props=>{const initialState={token:localStorage.getItem('token'),isAuthenticated:null,loading:true,user:null,error:null};const[state,dispatch]=useReducer(authReducer,initialState);// Load User\nconst loadUser=async()=>{if(localStorage.token){setAuthToken(localStorage.token);}try{// Use the backend URL from environment or default to local\nconst baseURL=process.env.REACT_APP_API_URL||'';const res=await axios.get(`${baseURL}/api/auth`);dispatch({type:USER_LOADED,payload:res.data});}catch(err){dispatch({type:AUTH_ERROR});}};// Register User\nconst register=async formData=>{const config={headers:{'Content-Type':'application/json'}};try{const baseURL=process.env.REACT_APP_API_URL||'';const res=await axios.post(`${baseURL}/api/users`,formData,config);dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();}catch(err){dispatch({type:REGISTER_FAIL,payload:err.response.data.errors?err.response.data.errors[0].msg:'Registration failed'});}};// Login User\nconst login=async formData=>{const config={headers:{'Content-Type':'application/json'}};try{const baseURL=process.env.REACT_APP_API_URL||'';const res=await axios.post(`${baseURL}/api/auth`,formData,config);dispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();}catch(err){dispatch({type:LOGIN_FAIL,payload:err.response.data.errors?err.response.data.errors[0].msg:'Invalid credentials'});}};// Logout\nconst logout=()=>dispatch({type:LOGOUT});// Clear Errors\nconst clearErrors=()=>dispatch({type:CLEAR_ERRORS});return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,user:state.user,error:state.error,register,loadUser,login,logout,clearErrors},children:props.children});};export default AuthState;","map":{"version":3,"names":["React","useReducer","axios","AuthContext","authReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","jsx","_jsx","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","loading","user","error","state","dispatch","loadUser","baseURL","process","env","REACT_APP_API_URL","res","get","type","payload","data","err","register","formData","config","headers","post","response","errors","msg","login","logout","clearErrors","Provider","value","children"],"sources":["C:/Users/perik/OneDrive/mern-auth/client/src/context/AuthState.js"],"sourcesContent":["import React, { useReducer } from 'react';\nimport axios from 'axios';\nimport AuthContext from './AuthContext';\nimport authReducer from './authReducer';\nimport setAuthToken from '../utils/setAuthToken';\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERRORS\n} from './types';\n\nconst AuthState = props => {\n  const initialState = {\n    token: localStorage.getItem('token'),\n    isAuthenticated: null,\n    loading: true,\n    user: null,\n    error: null\n  };\n\n  const [state, dispatch] = useReducer(authReducer, initialState);\n\n  // Load User\n  const loadUser = async () => {\n    if (localStorage.token) {\n      setAuthToken(localStorage.token);\n    }\n\n    try {\n      // Use the backend URL from environment or default to local\n     \n      const baseURL = process.env.REACT_APP_API_URL || '';\nconst res = await axios.get(`${baseURL}/api/auth`);\n\n      dispatch({\n        type: USER_LOADED,\n        payload: res.data\n      });\n    } catch (err) {\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n\n  // Register User\n  const register = async formData => {\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    };\n\n    try {\n      const baseURL = process.env.REACT_APP_API_URL || '';\n      const res = await axios.post(`${baseURL}/api/users`, formData, config);\n\n      dispatch({\n        type: REGISTER_SUCCESS,\n        payload: res.data\n      });\n\n      loadUser();\n    } catch (err) {\n      dispatch({\n        type: REGISTER_FAIL,\n        payload: err.response.data.errors ? err.response.data.errors[0].msg : 'Registration failed'\n      });\n    }\n  };\n\n  // Login User\n  const login = async formData => {\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    };\n\n    try {\n      const baseURL = process.env.REACT_APP_API_URL || '';\nconst res = await axios.post(`${baseURL}/api/auth`, formData, config);\n\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: res.data\n      });\n\n      loadUser();\n    } catch (err) {\n      dispatch({\n        type: LOGIN_FAIL,\n        payload: err.response.data.errors ? err.response.data.errors[0].msg : 'Invalid credentials'\n      });\n    }\n  };\n\n  // Logout\n  const logout = () => dispatch({ type: LOGOUT });\n\n  // Clear Errors\n  const clearErrors = () => dispatch({ type: CLEAR_ERRORS });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n        loading: state.loading,\n        user: state.user,\n        error: state.error,\n        register,\n        loadUser,\n        login,\n        logout,\n        clearErrors\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthState;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}